- cache_if current_user.guest?, [I18n.locale, :product_detail, product] do
  .product-header
    .actions
      - if current_user.can_update?(product)
        = link_to icon('edit', t('actions.edit')), edit_admin_product_path(product), class: 'btn btn-default'
      = link_to icon('times'), '#back', class: 'btn btn-default'
    %h1.product-title
      = product.title
      %span.small= product.subtitle

  .product-body
    .images.presentational
      = render partial: 'products/images', locals: {product: product, purpose: :presentational}

    .product-meta
      %p.product-code
        - if product.customer_code.present?
          = icon('barcode', product.customer_code, class: 'fa-lg')
        = icon('barcode', product.code, class: 'fa-lg fa-flip-horizontal')

      .buy-now
        .product-pricing
          = render partial: 'products/pricing', object: product, as: :product
        = render partial: 'products/buy_now', object: product, as: :product
        = render partial: 'store/go_checkout'

      - if product.variant?
        .variant-products
          = render partial: 'products/variants_dropdown', object: product, as: :product

      .product-stock
        = render partial: 'products/stock', object: product, as: :product

    .product-description
      %ul.nav.nav-tabs.nav-sm{role: 'tablist'}
        %li.active{role: 'presentation'}
          %a{href: '#tab-description', role: 'tab', data: {toggle: 'tab'}}
            = t('store.product_description')
        - if product.images.document.any?
          %li{role: 'presentation'}
            %a{href: '#tab-documents', role: 'tab', data: {toggle: 'tab'}}
              = t('store.product_documentation')
        - if product.product_properties.any?
          %li{role: 'presentation'}
            %a{href: '#tab-properties', role: 'tab', data: {toggle: 'tab'}}
              = t('store.product_properties')
        - if product.component_entries.live.any?
          %li{role: 'presentation'}
            %a{href: '#tab-component-entries', role: 'tab', data: {toggle: 'tab'}}
              = t('store.component_entries')
      .tab-content
        #tab-description.tab-pane.fade.in.active
          .body-text><
            = product.description.html_safe if product.description.present?
        - if product.images.document.any?
          #tab-documents.tab-pane.fade
            .documents.list-group
              - product.images.document.each do |document|
                = link_to(icon('paperclip', document.to_s),
                    document.url(:original), class: 'list-group-item')
        - if product.product_properties.any?
          = render partial: 'products/properties_panel', object: product, as: :product
        - if product.component_entries.live.any?
          = render partial: 'products/components_panel', object: product, as: :product

    .images.technical
      = render partial: 'products/images', locals: {product: product, purpose: :technical}

    - if product.iframes.any?
      .iframes
        = render partial: 'iframes/gallery', object: product, as: :product, locals: {inline: current_store.inline_iframes}

  .product-footer

    - if product.variant?
      %h2= t('store.product_variants')
      .variant-products
        %ul= render partial: 'products/variant_product', collection: product.sibling_variants.live.sorted, as: :product, locals: {context: product}

    - if product.requisite_products.live.any?
      %h2= t('store.requisite_products')
      .requisite-products
        %ul= render partial: 'products/requisite_product', collection: product.requisite_products.live, as: :product

    #offer-requisites-modal.modal{data: {backdrop: 'static'}}
      .modal-dialog.modal-lg
        .modal-content
          .modal-header
            %button.close{data: {dismiss: 'modal'}}= icon('close')
            %h4.modal-title= t('store.offer_requisites')
          .modal-body.requisite-products
            %ul
